<!DOCTYPE html>
<html lang="en" ng-app="KeyStyle">
<head>
    <title>Place registration</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Bootstrap -->
    <link href="../../../static/bower/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../../../static/css/font-awesome.css" rel="stylesheet"/>
    <link href="../../../static/bower/Jcrop/css/Jcrop.min.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="../../../static/bower/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="../../../static/bower/jquery-ui/jquery-ui.min.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="../../../static/bower/Jcrop/js/Jcrop.min.js"></script>

    <script type="text/javascript" src="../../../static/bower/angular-1.5.0-rc.0/angular.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../../../static/bower/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../../../static/js/controllers/place-profile.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <![endif]-->
</head>
<body ng-controller="PlaceRegistration">
<div class="container">
    <div class="row">
        <div class="col col-xs-10 col-xs-offset-1 col-md-8  col-md-offset-2 col-lg-6 col-lg-offset-0">
            <div style="margin-top: 15px;" class="jumbotron">
                <form action="" ng-form="newPlace" ng-submit="createNewPlace(newPlace)" method="get" class="form-horizontal">
                    <fieldset>
                        <legend>Реестрація нового закладу</legend>

                        <div class="thumbnail" style="background-color: #6DB3DF; color: white;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="inputEmail" class="col-lg-2 control-label">Назва</label>

                                <div class="col-lg-10">
                                    <input ng-model="newPlace.name" type="text" class="form-control" id="inputEmail" placeholder="Назва закладу">
                                </div>
                            </div>
                        </div>


                        <div class="form-group" id="description-wrapper">
                            <label for="description" class="col-lg-2 control-label">Опис</label>

                            <div class="col-lg-10">
                                <textarea ng-model="newPlace.description" style="resize: vertical" class="form-control" rows="3"
                                          id="description"></textarea>
                                <span class="help-block" id="description-advice">Залишилось  символів
                                    <span style="display: inline;">{{getDescriptionLen()}}</span>
                                </span>
                            </div>
                        </div>


                        <br/>

                        <div class="form-control">
                            <input id="input-image"  type="file"/>
                            <input ng-model="newPlace.w" type="hidden" id="w"/>
                            <input ng-model="newPlace.h" type="hidden" id="h"/>
                            <input ng-model="newPlace.x" type="hidden" id="x"/>
                            <input ng-model="newPlace.y" type="hidden" id="y"/>
                        </div>
                        <br/>

                        <div style="text-align: right" class="form-group">
                            <div style="float: right" class="col-lg-10">
                                <button type="reset" class="btn btn-default">Cancel</button>
                                <button  type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="crop-it">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header alert alert-info">
                <button style="margin-top: -9px;" type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <strong>Увага!</strong> Виділіть границі за якими ваша фотографія буде оброблена
            </div>
            <div class="modal-body">
                <div class="jcrop-wrapper">
                    <img src="" id="crop-this-shit"/>
                </div>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <a data-dismiss="modal" class="btn btn-success">Ok!</a>
                    <a class="btn" data-dismiss="modal" id="modal-csl">Відміна</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var jcrop_api;
    var descriptionIsOk = true;

    $(document).ready(function () {
        var src;
        var image;

        var imageInput = $("#input-image");
        $("#modal-csl").click(function () {
            imageInput.src = undefined;
        });
        imageInput.change(function () {
            if (jcrop_api != undefined) {
                jcrop_api.destroy();
            }

            $("#crop-it").modal('show');

        });

        $("#crop-it").on("show.bs.modal", function () {
            src = document.getElementById("input-image");
            image = document.getElementById("crop-this-shit");

            var fr = new FileReader();
            // when image is loaded, set the src of the image where you want to display it
            fr.readAsDataURL(src.files[0]);
            fr.onload = function (e) {
                image.src = this.result;
                initJcrop(image);
            };
        });
    });

    function showCoords(c) {
        $('#x').val(c.x);
        $('#y').val(c.y);
        $('#w').val(c.w);
        $('#h').val(c.h);
    }

    function initJcrop(img) {
        jQuery(img).Jcrop({
            addClass: 'jcrop-centered',
            aspectRatio: 3.5 / 4,
            onChange: showCoords,
            setSelect: [0, 35, 40, 0],
            onSelect: showCoords
        }, function () {
            jcrop_api = this;
            $(".jcrop-centered").css({
                marginLeft: -img.width / 2
            });

        });
    }


</script>
</body>
</html>